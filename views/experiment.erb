
<div class="page-header">
  <h1><%= @experiment.name %></h1>
</div>

<div class="row-fluid span-12">
  
  <%if @user.nil? %>
    <script type = "text/javascript">
      $(document).ready(function(){
        $("#sharelink").remove();
      });
    </script>
  <% end %>
  
  <div class="share_button">
    <script type="text/javascript">
    getSharelink = function() {
      $.getJSON("/getrandomstring/experiment/<%= @experiment.id %>", function(result) {
      if (result.status == 'okay' && result.value ) {
        content = result.value
      } else {
        content = "something went wrong :("
      }
      $("#random_string_box").append("http://triplab.ad.ufl.edu:3000/path/"+content);
      $("#sharelink").remove();
      });
    };
  
    getSharefile = function(fileid){
      $.getJSON("/getrandomstring/dataset/"+fileid, function(result){
        if (result.status == 'okay' && result.value ) {
          content = result.value
        } else {
          content = "something went wrong :("
        }
        $("#sharelabel"+fileid).append("http://triplab.ad.ufl.edu:3000/path/"+content); 
        $("#sharefile"+fileid).remove();
      });
    };
    </script>
    <a href="#" onClick="getSharelink();" id="sharelink">Share</a>
    <p id="random_string_box"></p>
  </div>


  <div class="row-fluid">
    <div class="span12">
      <p>Last Change: <%= pretty_time @experiment.update_at || @experiment.created_at %></p>
    </div>
  </div>
  
  <div class="row-fluid">
    <div class="span12">

      <% if @experiment.users.length == 0 %>
        <p>This experiment is an orphan!</p>
      <% else %>
        <h2>Owners</h2>
        <ul class="undecorated">
          <% @experiment.users.each do |user| %>
            <li><a href="/user/<%= user.id %>"><%= user.name %></a></li>
            <% user.inspect %>
          <% end %>
        </ul>
      <% end %>
    </div>
  </div>

  <div class="row-fluid">
    <div class="span12">
      <h2>Description</h2>
      <blockquote>
        <%= @experiment.description || 'no description' %>
      </blockquote>
    </div>
  </div>

  <div class="row-fluid">
    <div class="span12">

      <% if @experiment.datasets.length == 0 %>
        <p>No files!</p>
      <% else %>
        <h2>Files</h2>
        <ul class="undecorated">
          <% @experiment.datasets.each do |file| %>
            <li>
              <a href="/file/<%= file.id %>"><%= file.name %> - <%= file.created_at%> - <%= file.user.name %></a>
              <% if @user %>
                - <a href="#" onClick="getSharefile(<%= file.id %>);" id="sharefile<%= file.id %>">Share File</a>
              <% end %>
              <a id="sharelabel<%= file.id%>"></a>
            </li>
          <% end %>
        </ul>
      <% end %>
    </div>
  </div>

  <div class="actions">
    <div id="user_buttons">
      <% if session[:user_id] && !@experiment.users.first(:id => @user.id).nil? %>
        <%= link_tag :to => "/experiment/#{@experiment.id}/edit", :name => 'Edit', :class => 'btn' %>
        <%= link_tag :to => "/experiment/#{@experiment.id}/add_owner", :name => 'Add Owner', :class => 'btn' %>
        <%= link_tag :to => "/file/new?experiment=#{@experiment.id}", :name => 'Add File', :class => 'btn' %>
      <% end %>
    </div>
  </div>
</div>